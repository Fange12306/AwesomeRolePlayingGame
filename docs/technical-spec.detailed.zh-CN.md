# RPG 框架详细技术规格（中文·面向读者版）

本文件是对当前讨论规划的**完整、可阅读的详细规格说明**，面向项目成员与产品/叙事设计者。目标是描述一个由多 Agent 协作驱动的角色扮演游戏（RPG）框架，强调**世界观先行**、**剧情层级控制**、**属性/判定系统可显隐**、**存档与一致性**等核心特性。

> 备注：本文档为规划与规格说明，不涉及具体实现代码。

---

## 1. 设计目标与核心理念

### 1.1 核心目标
- 构建一个**多轮对话驱动**的角色扮演与叙事体验系统。
- 通过多 Agent 协作实现**世界观构建—剧情推进—规则判定—叙事输出—状态保存**的完整闭环。
- 在长线叙事中避免“边讲边编导致设定爆炸”，保持一致性与可控性。

### 1.2 关键设计理念
- **世界观先行**：每次新游戏开始前先生成“宏观世界框架”，后续剧情中按需细化。
- **剧情层级**：始终处于“宏观主线（Arc）+ 当前小剧情（Scene）”的双层结构中。
- **规则可显隐**：属性与判定系统既可对玩家显式展示，也可隐性执行以保证沉浸感。
- **可保存可恢复**：存档包含世界观、剧情层级、规则与当前节点，保证恢复一致性。

---

## 2. 系统总体架构与多 Agent 协作

### 2.1 Agent 分工与职责
- **NarratorAgent（叙事）**
  - 负责生成面向用户的叙事文本。
  - 依据剧情与规则结果产出一致的故事推进。

- **WorldbuilderAgent（世界观）**
  - 初始化游戏时生成宏观世界骨架。
  - 根据剧情触发点进行增量细化，不覆盖已有设定。

- **PlotDirectorAgent（剧情导演）**
  - 管理剧情层级结构（Arc/Scene）。
  - 根据玩家行动选择剧情分支并推进 Scene。

- **RulesEngineAgent（规则引擎）**
  - 负责属性判定与掷骰逻辑。
  - 输出判定结果，支持显性/隐性模式。

- **StateManagerAgent（状态管理）**
  - 负责读取/写入世界观、剧情、规则与存档。
  - 维护一致性校验与冲突处理。

### 2.2 Agent 交互流程（高层）
1. **StateManagerAgent** 提供当前状态（世界观/剧情/属性摘要）。
2. **PlotDirectorAgent** 根据状态与玩家输入确定剧情走向与 Scene 变化。
3. **RulesEngineAgent** 对关键行动进行判定并生成结果。
4. **NarratorAgent** 结合剧情与判定输出叙事文本。
5. **StateManagerAgent** 写入本轮增量与存档更新。

---

## 3. 世界观机制：先骨架，后细化

### 3.1 世界观初始化
每次游戏开始前，WorldbuilderAgent 基于玩家选择的题材/世界观生成宏观设定骨架，包含：
- 时代背景与世界关键词
- 地理格局与大陆分布
- 国家/势力与基础关系
- 科技、军事、社会与文化基线

### 3.2 增量细化策略
- 只有当剧情涉及某地区、势力或人物时才触发细化。
- 细化只允许**补充空白字段**，不允许覆盖已有内容。
- 如果新增信息与已有设定冲突，必须返回冲突报告给 PlotDirectorAgent。

### 3.3 角色信息与玩家关系
世界观层面需要维护关键角色数据，并明确与玩家的关系：
- 角色身份、背景与阵营
- 与玩家的关系（同盟/敌对/中立/未知）
- 关系变化记录（可用于剧情影响）

---

## 4. 剧情层级结构：Arc 与 Scene 并行

### 4.1 双层剧情结构
- **Arc（宏观主线）**：描述一个较长周期的剧情目标与冲突。
- **Scene（当前小剧情）**：描述具体场景与当下互动内容。

每轮交互必须绑定一个 Scene，同时归属于某个 Arc，确保叙事始终有上下文支撑。

### 4.2 Arc 结构要素
- 主题与目标
- 主冲突与潜在分支
- 触发条件与结束条件

### 4.3 Scene 结构要素
- 地点与事件描述
- 参与角色
- 玩家可选行动
- 可能的判定点

### 4.4 推进逻辑
- PlotDirectorAgent 根据玩家行动推进 Scene。
- Scene 结束后，要么进入新 Scene，要么触发 Arc 结束。
- Arc 结束后生成新 Arc 的骨架，仍保持“先骨架再细化”原则。

---

## 5. 属性与判定系统

### 5.1 属性系统
- 属性类别取决于世界观类型。
- 除主角外，NPC 与环境也拥有属性数据。

示例：
- 航海题材可包含：航海术、炮术、贸易、风向理解等。
- 奇幻题材可包含：力量、敏捷、智慧、魔法等。

### 5.2 判定系统
- 判定模型可为掷骰、概率、阈值对比或混合。
- 判定结果会影响剧情分支与叙事输出。

### 5.3 显性/隐性模式
- **显性模式**：向玩家展示判定过程与数值。
- **隐性模式**：只展示叙事结果，隐藏数值细节。

---

## 6. 状态保存与加载

### 6.1 存档结构
每个存档包含完整状态：
- 世界观文件
- 剧情层级文件
- 规则/属性文件
- 当前节点摘要

### 6.2 保存流程
- StateManagerAgent 收集当前所有状态并持久化。
- 记录版本号与时间戳。

### 6.3 加载流程
- 读取存档摘要 → 恢复当前 Arc/Scene → 加载世界观与规则。

### 6.4 一致性校验
- 校验文件版本与哈希。
- 若冲突或不一致，提供回滚或修复策略。

---

## 7. 数据与目录建议（逻辑层面）

> 具体路径可根据仓库结构调整，这里是逻辑分类建议。

- `world/`：世界观数据
  - `overview`（宏观背景）
  - `regions`（地理/大陆）
  - `nations`（国家与势力）
  - `characters`（关键角色与玩家关系）

- `plot/`：剧情层级
  - `arc_index`（所有 Arc 状态）
  - `arc_current`（当前 Arc 摘要）
  - `scene_current`（当前 Scene 节点）

- `rules/`：规则/属性
  - `attributes`（属性定义）
  - `checks`（判定规则）
  - `visibility`（显隐设置）

- `saves/`：存档
  - `state`（当前节点摘要与索引）

---

## 8. 运行中的关键约束

- 任何世界观更新必须遵守“**不覆盖、只补充**”。
- 每轮叙事必须绑定到当前 Scene 与 Arc。
- 判定结果必须通过叙事语言体现，不允许与已知设定冲突。

---

## 9. 未来扩展方向
- 引入“经济/外交/势力动态”模拟 Agent。
- 允许多玩家并行进入同一世界观（多存档共享世界骨架）。
- 支持跨世界观“模组化规则配置”。

---

## 10. 总结

本规格文件确立了一个**多 Agent 驱动的 RPG 框架**设计方向，重点是：
1. 先构建世界观骨架再细化，避免设定爆炸；
2. 通过 Arc/Scene 双层结构约束剧情推进；
3. 属性与判定可显性或隐性执行；
4. 存档完整、恢复可靠。

本文件作为读者版技术规格，为后续落地实现与团队协作提供一致理解与统一语言。
