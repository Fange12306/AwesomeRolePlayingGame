# 属性系统设计文档（角色优先，规划中）

本文件描述一个与世界观无关的“角色属性系统”框架，用于在生成角色时引入稳定的属性结构，并支持世界观对属性名称和范围进行改写/裁剪。当前代码尚未集成该属性系统，作为规划文档保留。

## 目标与范围
- 先期只覆盖角色（character），但结构可扩展到其他实体类型（组织/政体/怪物/物品）。
- 属性分为“通用大类 + 细分小类”，世界观可更名或启用/禁用小类。
- 提供统一的范围与刻度体系（例如 1-20、0-10），并允许局部覆盖。
- 允许世界观派生“专业/知识”模块作为剧情相关属性。
- 兼容现有角色档案结构（`profile` JSON），通过新增 `attributes` 字段实现。

## 核心概念
- AttributeCategory（属性大类）：如“身体/体能、心智/认知”等。
- AttributeItem（属性小类）：具体数值项，如“力量、意志力、说服”。
- AttributeDomain（专业/知识模块）：由世界观启用的可选模块（大航海、修真、赛博等）。
- RangePolicy（范围策略）：控制数值范围、刻度、精度、默认值。
- AttributeValueSet（角色属性值集）：角色实际数值集合。

## Schema 建议（定义层）
### 角色属性定义（schema）示例
```json
{
  "version": "v1",
  "applies_to": ["character"],
  "default_range": [1, 20],
  "precision": "int",
  "categories": [
    {
      "key": "physical",
      "label": "身体/体能",
      "items": [
        {"key": "strength", "label": "力量"},
        {"key": "endurance", "label": "耐力"},
        {"key": "constitution", "label": "体质/抗性"},
        {"key": "agility", "label": "灵巧/协调"},
        {"key": "speed", "label": "速度"}
      ]
    },
    {
      "key": "cognitive",
      "label": "心智/认知",
      "items": [
        {"key": "logic", "label": "逻辑/推理"},
        {"key": "memory", "label": "记忆"},
        {"key": "learning", "label": "学习"},
        {"key": "creativity", "label": "创造"}
      ]
    }
  ],
  "domains": [
    {
      "key": "seafaring",
      "label": "航海专业",
      "items": [
        {"key": "navigation", "label": "航海学/导航"},
        {"key": "sailing", "label": "操帆/操舵"},
        {"key": "gunnery", "label": "炮术与海战战术"},
        {"key": "cartography", "label": "测绘/制图"},
        {"key": "trade", "label": "贸易/估价"}
      ]
    }
  ]
}
```

### 范围与刻度策略示例
```json
{
  "default_range": [1, 20],
  "category_range": {
    "resource": [0, 10],
    "domain": [0, 10]
  },
  "item_range": {
    "sanity": [0, 100],
    "reputation": [0, 10]
  },
  "precision": "int"
}
```

### 角色属性值集示例
```json
{
  "attributes": {
    "physical": {
      "strength": 12,
      "endurance": 9
    },
    "cognitive": {
      "logic": 14,
      "memory": 10
    },
    "domain": {
      "seafaring": {
        "navigation": 7,
        "cartography": 5
      }
    }
  }
}
```

## 通用大类与细分小类（角色）
这些大类在任何世界观下都适用，小类名称可替换但含义应保留。

1) 身体/体能
- 力量：纯物理输出与负荷能力
- 耐力：持续行动与体能储备
- 体质/抗性：抗打击、抗病、抗毒
- 灵巧/协调：精细动作与身体协调
- 速度：移动与反应速度

2) 感知/察觉
- 视听敏锐：基础感官能力
- 警觉：发现威胁与异常
- 洞察/直觉：读懂他人或局势
- 环境感知：空间感、方向感

3) 心智/认知
- 逻辑/推理：分析与推断
- 记忆：信息保留与调用
- 学习：掌握新知识的效率
- 创造：方案与创意生成

4) 意志/心理
- 意志力：对抗干扰与诱惑
- 自控/纪律：克制与执行力
- 勇气：面对风险的稳定性
- 情绪稳定：心理波动的抗压

5) 社交/影响
- 魅力/气场：第一印象与吸引力
- 共情：理解他人情绪与需求
- 说服/谈判：改变他人意愿
- 领导/号召：组织与凝聚
- 威慑：压制与震慑

6) 生存/适应
- 适应性：对陌生环境的调整
- 恢复力：受损后的复原
- 环境耐受：极端环境生存力
- 应变：突发情况的处理

7) 资源/地位
- 财富/资源：可调度的物资
- 声望：社会认知度与评价
- 关系网络：可动员的人脉
- 权势/地位：制度层面的影响力

8) 经验/熟练
- 训练度/专业度：通用“熟练度”指标
- 可扩展为具体技能树（武艺/技术/法术等）

9) 专业/知识（剧情模块）
- 作为“世界观驱动”的可选模块
- 例如大航海时代：航海学/导航、操帆/操舵、炮术与海战战术、测绘/制图、贸易/估价、港口规章

10) 状态/派生（可选）
- 生命/体力/精力、精神/理智、士气/斗志、负伤/疲劳
- 推荐从通用属性派生，必要时可直接赋值

## 范围与刻度建议
- 默认范围：1-20（整数）。
- “资源/地位”“专业/知识”建议 0-10。
- “精神/理智”可用 0-100。
- 精度：`int`（默认）或 `float`（更细腻）。

## 校验与归一化策略
- 对每个数值执行 clamp（限制在 min/max 内）。
- 若字段缺失：
  - 使用默认值或世界观提供的均值。
  - 保留旧值（更新流程）。
- 支持“非数值型”补充字段（如标签/资质），但应与数值字段分层存储。

## 与现有角色系统的集成建议
- **Prompt 层**：
  - `character/character_prompt.py` 增加 `attributes` 输出要求。
  - 将 schema 与 range 作为上下文附加到 prompt。
- **生成层**：
  - `CharacterEngine._parse_profile` 保持 JSON 解析。
  - 新增 `AttributeValidator` 校验与裁剪数值。
- **更新层**：
  - `CharacterAgent._build_update_prompt` 添加属性字段要求。
  - `_normalize_profile_update` 保持属性字段完整性。

## 示例：世界观驱动扩展
- 大航海时代：启用航海专业模块并降低魔法类属性权重。
- 赛博朋克：新增“义体兼容、黑客能力、网络身份”模块。
- 修真世界：新增“灵根、悟性、灵力、心境”模块。

## 未来扩展
- 组织/政体属性面板（国力、军力、科技、民心）。
- 属性驱动的剧情生成规则（触发条件、难度判定）。
- 规则引擎接口（骰子系统、胜率计算）。
